- name: Launch Cloudflare Tunnel
        shell: pwsh
        run: |
          Write-Host "Creating secure tunnel..."
          # Start cloudflared and capture BOTH standard output and errors
          Start-Process cloudflared -ArgumentList "tunnel --url http://127.0.0.1:6080" -RedirectStandardError "cloudflare.log" -NoNewWindow
          
          Write-Host "Waiting for Cloudflare to generate URL..."
          $url = $null
          $attempts = 0
          
          # Loop for 30 seconds until the URL appears in the logs
          while ($attempts -lt 15 -and -not $url) {
              Start-Sleep -Seconds 2
              if (Test-Path "cloudflare.log") {
                  $content = Get-Content "cloudflare.log" -Raw
                  # Search for the trycloudflare pattern
                  if ($content -match "https://[a-zA-Z0-9-]+\.trycloudflare\.com") {
                      $url = $matches[0]
                  }
              }
              $attempts++
              Write-Host "Searching... (Attempt $attempts)"
          }
          
          if ($url) {
              Write-Host "`n=========================================="
              Write-Host "SUCCESS! YOUR LINK IS BELOW:"
              Write-Host "ACCESS URL: $url"
              Write-Host "VNC PASSWORD: VNCpass123!"
              Write-Host "==========================================`n"
          } else {
              Write-Error "Cloudflare failed to provide a URL. Check cloudflare.log below:"
              Get-Content "cloudflare.log"
          }
          
          # Keep the VM alive
          while($true) { Start-Sleep 300 }
